{% extends 'layout.html' %}

{% block title %}{{ t.post_new_job }} - GrameenConnect{% endblock %}

{% block extra_css %}
{{ super() }}
<style>
    /* Custom styles for dropdown menus in the new job page */
    .dropdown-menu {
        display: none;
        background-color: #fff !important;
        border: 1px solid rgba(0,0,0,.15) !important;
        border-radius: 0.375rem !important;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2) !important;
        padding: 0.5rem 0 !important;
        z-index: 1050 !important;
    }
    
    .dropdown-menu.show {
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
    }
    
    .dropdown-item {
        display: block;
        width: 100%;
        padding: 0.5rem 1.5rem;
        clear: both;
        font-weight: 400;
        color: #212529 !important;
        text-align: inherit;
        white-space: nowrap;
        background-color: transparent;
        border: 0;
    }
    
    .dropdown-item:hover, .dropdown-item:focus {
        color: #16181b !important;
        text-decoration: none;
        background-color: #f8f9fa !important;
    }
    
    /* Navbar specific dropdown fixes */
    .navbar .dropdown-menu {
        background-color: #fff !important;
        color: #212529 !important;
        min-width: 10rem !important;
        padding: 0.5rem 0 !important;
        margin: 0 !important;
        border: 1px solid rgba(0,0,0,0.15) !important;
        border-radius: 0.25rem !important;
        display: none;
    }
    
    .navbar .dropdown-menu.show {
        display: block !important;
    }
    
    .navbar .dropdown-item {
        color: #212529 !important;
        padding: 0.5rem 1rem !important;
    }
    
    .navbar .dropdown-item:hover {
        background-color: #f8f9fa !important;
        color: #16181b !important;
    }
    
    /* Language dropdown specific styling */
    .language-dropdown {
        min-width: 180px !important;
        max-width: 180px !important;
    }
    
    /* User dropdown specific styling */
    .user-dropdown .dropdown-menu {
        min-width: 200px !important;
        max-width: 300px !important;
    }
    
    /* Ensure form elements look good on the page */
    .card.feature-card {
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        border: none;
        border-radius: 0.5rem;
        overflow: hidden;
    }
    
    .form-label {
        font-weight: 500;
    }
    
    .input-group .btn {
        z-index: 0; /* Fix z-index issues with input groups */
    }
    
    /* Fix for mobile screens */
    @media (max-width: 767px) {
        .dropdown-menu {
            position: absolute !important;
            width: auto !important;
            min-width: 10rem !important;
        }
        
        /* Additional mobile-specific fixes for navbar dropdowns */
        .navbar-nav.ms-auto .dropdown-menu {
            width: auto !important;
            max-width: calc(100vw - 30px) !important;
            right: 10px !important;
            left: auto !important;
        }
        
        /* Fix for overlapping content in mobile view */
        body.dropdown-open {
            overflow: hidden;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-4">
    <div class="row">
        <div class="col-md-10 col-lg-8 mx-auto">
            <div class="card feature-card">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0">{{ t.post_new_job }}</h4>
                </div>
                <div class="card-body">
                    <form method="post" action="{{ url_for('new_job') }}">
                        <div class="mb-3">
                            <label for="title" class="form-label">{{ t.job_title }}</label>
                            <input type="text" class="form-control" id="title" name="title" required placeholder="{{ t.job_title_placeholder }}">
                        </div>
                        
                        <div class="mb-3">
                            <label for="category" class="form-label">{{ t.job_category }}</label>
                            <select class="form-select" id="category" name="category" required>
                                <option value="" selected disabled>{{ t.select_category }}</option>
                                <option value="Agriculture">{{ t.agriculture }}</option>
                                <option value="Labor">{{ t.labor }}</option>
                                <option value="Tutoring">{{ t.tutoring }}</option>
                                <option value="Skilled Trade">{{ t.skilled_trade }}</option>
                                <option value="Other">{{ t.other }}</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="description" class="form-label">{{ t.job_description_label }}</label>
                            <textarea class="form-control" id="description" name="description" rows="4" required placeholder="{{ t.job_description_placeholder }}"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="eligibility" class="form-label">{{ t.eligibility_label }}</label>
                            <textarea class="form-control" id="eligibility" name="eligibility" rows="3" placeholder="{{ t.eligibility_placeholder }}"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="salary" class="form-label">{{ t.salary_label }}</label>
                            <input type="text" class="form-control" id="salary" name="salary" placeholder="{{ t.salary_placeholder }}">
                        </div>
                        
                        <div class="mb-3">
                            <label for="deadline" class="form-label">{{ t.deadline_label }}</label>
                            <input type="date" class="form-control" id="deadline" name="deadline">
                        </div>
                        
                        <div class="mb-3">
                            <label for="location" class="form-label">{{ t.location_label }}</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="location" name="location" placeholder="{{ t.location_placeholder }}">
                                <button class="btn btn-outline-success" type="button" id="get-location">
                                    <i class="bi bi-geo-alt"></i> {{ t.use_current_location }}
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="contact" class="form-label">{{ t.contact_label }}</label>
                            <input type="text" class="form-control" id="contact" name="contact" required placeholder="{{ t.contact_placeholder }}">
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-success">{{ t.post_job_button }}</button>
                            <a href="{{ url_for('jobs') }}" class="btn btn-outline-secondary">{{ t.cancel_button }}</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Fix for language dropdown and user profile dropdown in the navbar
        function fixDropdowns() {
            // Initialize all dropdowns properly
            const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
            
            // First, remove any existing event listeners to prevent duplicates
            dropdownToggles.forEach(function(toggle) {
                const newToggle = toggle.cloneNode(true);
                toggle.parentNode.replaceChild(newToggle, toggle);
            });
            
            // Re-query after replacing elements
            const refreshedToggles = document.querySelectorAll('.dropdown-toggle');
            
            refreshedToggles.forEach(function(toggle) {
                toggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const dropdownMenu = this.nextElementSibling;
                    if (dropdownMenu && dropdownMenu.classList.contains('dropdown-menu')) {
                        // Toggle body class for dropdown state
                        const isOpening = !dropdownMenu.classList.contains('show');
                        
                        // Close any other open dropdowns first
                        document.querySelectorAll('.dropdown-menu.show').forEach(function(menu) {
                            if (menu !== dropdownMenu) {
                                menu.classList.remove('show');
                            }
                        });
                        
                        // Toggle this dropdown
                        dropdownMenu.classList.toggle('show');
                        
                        // Toggle body class based on any dropdown being open
                        if (isOpening) {
                            document.body.classList.add('dropdown-open');
                        } else if (document.querySelectorAll('.dropdown-menu.show').length === 0) {
                            document.body.classList.remove('dropdown-open');
                        }
                        
                        // Position the dropdown correctly
                        const rect = this.getBoundingClientRect();
                        dropdownMenu.style.position = 'absolute';
                        dropdownMenu.style.zIndex = '1051'; // Higher than Bootstrap's default
                        dropdownMenu.style.top = rect.bottom + 'px';
                        
                        // Left align for language dropdown, right align for user dropdown
                        if (this.id === 'languageDropdown') {
                            // Language dropdown positioning
                            dropdownMenu.style.left = Math.max(0, rect.left) + 'px';
                            dropdownMenu.style.right = 'auto';
                            dropdownMenu.style.minWidth = '180px';
                            dropdownMenu.style.maxWidth = '180px';
                        } else if (this.id === 'userDropdown') {
                            // User dropdown positioning (right-aligned)
                            const rightEdge = window.innerWidth - rect.right;
                            dropdownMenu.style.left = 'auto';
                            dropdownMenu.style.right = rightEdge + 'px';
                            dropdownMenu.style.minWidth = '200px';
                            dropdownMenu.style.maxWidth = '300px';
                        }
                        
                        // Add a click event to close the dropdown when clicking outside
                        const closeHandler = function(event) {
                            if (!toggle.contains(event.target) && !dropdownMenu.contains(event.target)) {
                                dropdownMenu.classList.remove('show');
                                document.removeEventListener('click', closeHandler);
                                
                                // Remove body class if no dropdowns are open
                                if (document.querySelectorAll('.dropdown-menu.show').length === 0) {
                                    document.body.classList.remove('dropdown-open');
                                }
                            }
                        };
                        
                        // Ensure only one handler is added by removing existing ones
                        document.removeEventListener('click', closeHandler);
                        
                        setTimeout(() => {
                            document.addEventListener('click', closeHandler);
                        }, 0);
                    }
                });
            });
            
            // Also close dropdowns on Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.dropdown-menu.show').forEach(function(menu) {
                        menu.classList.remove('show');
                    });
                    document.body.classList.remove('dropdown-open');
                }
            });
        }
        
        // Fix navigation bar dropdowns
        fixDropdowns();
        
        // Call the fix again if the window is resized (for responsive layouts)
        window.addEventListener('resize', function() {
            document.querySelectorAll('.dropdown-menu.show').forEach(function(menu) {
                menu.classList.remove('show');
            });
            document.body.classList.remove('dropdown-open');
        });
        
        // Get current location functionality for the location field
        const getLocationButton = document.getElementById('get-location');
        const locationInput = document.getElementById('location');
        
        if (getLocationButton && locationInput) {
            getLocationButton.addEventListener('click', function() {
                if (navigator.geolocation) {
                    getLocationButton.disabled = true;
                    getLocationButton.innerHTML = '<i class="bi bi-hourglass-split"></i> {{ t.getting_location }}';
                    
                    navigator.geolocation.getCurrentPosition(function(position) {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        
                        // Use reverse geocoding to get location name (simplified implementation)
                        // In a real app, you might use a service like Google Maps API
                        locationInput.value = `${lat.toFixed(4)}, ${lng.toFixed(4)}`;
                        
                        getLocationButton.disabled = false;
                        getLocationButton.innerHTML = '<i class="bi bi-geo-alt"></i> {{ t.use_current_location }}';
                    }, function(error) {
                        console.error("Error getting location:", error);
                        alert("Could not get your location. Please enter it manually.");
                        
                        getLocationButton.disabled = false;
                        getLocationButton.innerHTML = '<i class="bi bi-geo-alt"></i> {{ t.use_current_location }}';
                    });
                } else {
                    alert("Geolocation is not supported by your browser. Please enter location manually.");
                }
            });
        }
        
        // Force initialization after a short delay to ensure all DOM elements are loaded
        setTimeout(fixDropdowns, 500);
    });
</script>
{% endblock %} 